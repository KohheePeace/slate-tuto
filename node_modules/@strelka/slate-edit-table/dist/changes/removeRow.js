'use strict';

var TablePosition = require('../utils/TablePosition');

/**
 * Remove current row in a table. Clear it if last remaining row
 *
 * @param {Object} opts
 * @param {Slate.Transform} change
 * @param {Number} at
 * @return {Slate.Transform}
 */
function removeRow(opts, change, at) {
  var value = change.value;
  var startBlock = value.startBlock;


  var pos = TablePosition.create(change, startBlock, opts);
  var table = pos.table;


  if (typeof at === 'undefined') {
    at = pos.getRowIndex();
  }

  var row = table.nodes.get(at);
  // Update table by removing the row
  if (pos.getHeight() > 1) {
    change.collapseToStartOfNextBlock().removeNodeByKey(row.key);
    // If last remaining row, clear it instead
  } else {
    row.nodes.forEach(function (cell) {
      cell.nodes.forEach(function (node) {
        change.collapseToStartOfNextBlock().removeNodeByKey(node.key);
      });
    });
  }

  return change;
}

module.exports = removeRow;