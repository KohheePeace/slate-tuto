'use strict';

var TablePosition = require('../utils/TablePosition');
var findBlock = require('../utils/findBlock');

/**
 * Move selection to {x,y}
 *
 * @param {Object} opts
 * @param {Slate.Transform} change
 * @param {Number} x
 * @param {Number} y
 * @return {Slate.Transform}
 */
function moveSelection(opts, change, x, y) {
  var value = change.value;


  var block = findBlock(opts.typeCell, change);
  if (block == null) {
    throw new Error('moveSelection can only be applied from within a cell');
  }

  var pos = TablePosition.create(change, block, opts);
  var table = pos.table;


  var row = table.nodes.get(y);
  var cell = row.nodes.get(x);

  // Calculate new offset
  var startOffset = value.startOffset;

  if (startOffset > cell.text.length) {
    startOffset = cell.text.length;
  }

  return change.collapseToEndOf(cell).moveOffsetsTo(startOffset);
}

module.exports = moveSelection;